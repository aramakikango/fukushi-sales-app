<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      :root { color-scheme: light dark; }
      *, *::before, *::after { box-sizing: border-box; }
      html, body { width:100%; max-width:100%; overflow-x:hidden; }
  body { font-family: Arial, sans-serif; padding: 24px; margin: 0; }
      nav { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
      nav a { margin-right: 12px; }
      /* compact floating theme toggle (icon) */
      #themeToggleBtn {
        width:44px; height:44px; display:flex; align-items:center; justify-content:center;
        position:fixed; top:12px; right:12px; z-index:9999;
        border-radius:999px; border:1px solid rgba(12,102,212,0.12);
        background:#fff; color:#0c66d4; box-shadow:0 2px 6px rgba(0,0,0,0.08); cursor:pointer;
        font-size:18px; line-height:1;
      }
      #themeToggleBtn:hover { transform:scale(1.06); }
      input, select, textarea { padding: 6px; }
  .table-wrap { width:100%; overflow-x:auto; -webkit-overflow-scrolling: touch; }
      table { width: 100%; border-collapse: collapse; margin-top: 16px; min-width: 720px; }
      th, td { border-bottom: 1px solid #eee; padding: 8px; text-align: left; }
      .row-actions button { margin-right: 6px; }
  .grid { display: grid; grid-template-columns: minmax(0,1fr) minmax(0,1fr); gap: 24px; }
      @media (max-width: 1000px) { .grid { grid-template-columns: 1fr; } }
  @media (max-width: 640px) { body { padding:16px; } .row-actions button { margin-bottom:6px; } input, select, textarea { font-size:18px; } button { padding:12px 16px; min-height:clamp(48px,8vh,64px); font-size:clamp(16px, 2.8vw + 12px, 20px); width:100%; border-radius:10px; } }
      /* Mobile: stack nav vertically and make full-width buttons */
      @media (max-width: 650px) {
        nav { flex-direction: column; align-items: stretch; }
        nav a, nav button { width: 100%; margin: 0 0 8px 0; border-radius: 10px; min-height: clamp(56px,10vh,72px); font-size: clamp(16px, 2.8vw + 12px, 20px); padding: clamp(14px,2vh,18px) 18px; }
  nav a { margin-right: 0; }
      }
      .muted { color: #666; font-size: 12px; }
      .flex { display: flex; gap: 8px; align-items: center; }
      @media (prefers-color-scheme: dark) {
        body { background:#111; color:#eaeaea; }
        th, td { border-bottom:1px solid #333; }
        input, select, textarea { background:#1e1e1e; color:#eaeaea; border:1px solid #333; }
        button { background:#2a2a2a; color:#eaeaea; border:1px solid #444; }
        .muted { color:#aaa; }
      }
      body.theme-dark { background:#111; color:#eaeaea; }
      body.theme-dark th, body.theme-dark td { border-bottom:1px solid #333; }
      body.theme-dark input, body.theme-dark select, body.theme-dark textarea { background:#1e1e1e; color:#eaeaea; border:1px solid #333; }
      body.theme-dark button { background:#2a2a2a; color:#eaeaea; border:1px solid #444; }
      body.theme-light { background:#fff; color:#111; }
      body.theme-dark #themeToggleBtn { background:#1a1a1a; color:#8ab4ff; border-color:#3769e6; }
      body.theme-dark #themeToggleBtn:hover { background:#1f3a75; color:#eaeaea; }
    </style>
    <script>
  function applyTheme(pref){ document.body.classList.remove('theme-dark','theme-light'); if(pref==='dark')document.body.classList.add('theme-dark'); if(pref==='light')document.body.classList.add('theme-light'); }
  function updateThemeButton(pref){ const b=document.getElementById('themeToggleBtn'); if(!b) return; if(pref==='dark'){ b.innerHTML='ğŸŒ™'; b.title='ãƒ†ãƒ¼ãƒ: ãƒ€ãƒ¼ã‚¯'; b.setAttribute('aria-label','ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰'); } else if(pref==='light'){ b.innerHTML='â˜€ï¸'; b.title='ãƒ†ãƒ¼ãƒ: ãƒ©ã‚¤ãƒˆ'; b.setAttribute('aria-label','ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰'); } else { b.innerHTML='ğŸŒ“'; b.title='ãƒ†ãƒ¼ãƒ: è‡ªå‹•'; b.setAttribute('aria-label','ãƒ†ãƒ¼ãƒ: è‡ªå‹•'); } }
      function initTheme(){ const p=localStorage.getItem('theme')||'system'; applyTheme(p); updateThemeButton(p); }
      function toggleTheme(){ const cur=localStorage.getItem('theme')||'system'; const next=cur==='system'?'dark':(cur==='dark'?'light':'system'); localStorage.setItem('theme',next); applyTheme(next); updateThemeButton(next); }
      // æ–½è¨­ä¸€è¦§ã®ç®¡ç†
      function loadFacilitiesForManage() {
        const tbody = document.getElementById('facManageRows');
        tbody.innerHTML = '<tr><td colspan="8">èª­ã¿è¾¼ã¿ä¸­...</td></tr>';
        google.script.run.withSuccessHandler(function(list){
          window._facList = list || [];
          renderFacilityRows();
        }).getFacilities({ limit: 500 });
      }
      function renderFacilityRows() {
        const tbody = document.getElementById('facManageRows');
        const kw = (document.getElementById('facFilterKw').value || '').toLowerCase();
        const pref = document.getElementById('facFilterPref').value || '';
        const type = document.getElementById('facFilterType').value || '';
        const list = (window._facList || []).filter(function(f){
          if (pref && f.prefecture !== pref) return false;
          if (type && f.facilityType !== type) return false;
          if (kw) {
            const hay = (f.name+' '+(f.address||'')+' '+(f.municipality||'')+' '+(f.notes||'')).toLowerCase();
            if (!hay.includes(kw)) return false;
          }
          return true;
        });
        if (!list.length) { tbody.innerHTML = '<tr><td colspan="8">è©²å½“ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>'; return; }
        let html = '';
        list.forEach(function(f){
          html += '<tr id="frow-'+f.id+'">'
            +'<td>'+escapeHtml(f.name)+'</td>'
            +'<td>'+escapeHtml(f.prefecture||'')+'</td>'
            +'<td>'+escapeHtml(f.municipality||'')+'</td>'
            +'<td>'+escapeHtml(f.facilityType||'')+'</td>'
            +'<td>'+escapeHtml(f.address||'')+'</td>'
            +'<td>'+escapeHtml(f.phone||'')+'</td>'
            +'<td class="row-actions">'
            +  '<button onclick="editFacility(\''+f.id+'\')">ç·¨é›†</button>'
            +  '<button onclick="openContactsPanel(\''+f.id+'\', \''+encodeURIComponent(f.name)+'\')">æ‹…å½“è€…</button>'
            +  '<button onclick="deleteFacilityReq(\''+f.id+'\')">å‰Šé™¤</button>'
            +'</td>'
            +'</tr>';
        });
        tbody.innerHTML = html;
      }
      function escapeHtml(s){return (s||'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
      function deleteFacilityReq(id){
        if (!confirm('æ–½è¨­ã‚’å‰Šé™¤ã—ã¾ã™ã€‚æ‹…å½“è€…ã‚‚å…¨ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
        google.script.run.withSuccessHandler(function(){
          loadFacilitiesForManage();
          if (document.getElementById('contactsFacilityId').value === id) {
            document.getElementById('contactsPanel').style.display = 'none';
          }
        }).deleteFacility(id);
      }
      function prefOptionsHtml(selected){
        const prefs=['æ±äº¬éƒ½','ç¥å¥ˆå·çœŒ','åƒè‘‰çœŒ','åŸ¼ç‰çœŒ','èŒ¨åŸçœŒ','æ ƒæœ¨çœŒ','ç¾¤é¦¬çœŒ','å±±æ¢¨çœŒ'];
        let html='<option value="">-- é¸æŠ --</option>';
        prefs.forEach(function(p){ html += '<option'+(p===selected?' selected':'')+'>'+p+'</option>'; });
        return html;
      }
      function facilityTypeCheckboxesHtml(selectedStr, id){
        const selected = new Set((selectedStr||'').split(/[ï¼,ã€]/).map(s=>s.trim()).filter(Boolean));
        const make = (val,label)=> '<label style="display:inline-block;width:190px;"><input type="checkbox" name="e-type-'+id+'" class="etype" value="'+val.replace(/\"/g,'&quot;')+'"'+(selected.has(val)?' checked':'')+'> '+label+'</label>';
        let html = '<div style="display:flex;flex-wrap:wrap;gap:8px;">';
        const vals = [
          'å±…å®…ä»‹è­·æ”¯æ´','è¨ªå•ä»‹è­·','é€šæ‰€ä»‹è­·','è¨ªå•çœ‹è­·','çœ‹è­·å°è¦æ¨¡å¤šæ©Ÿèƒ½','ç‰¹åˆ¥é¤Šè­·è€äººãƒ›ãƒ¼ãƒ ','æœ‰æ–™è€äººãƒ›ãƒ¼ãƒ ','ã‚µãƒ¼ãƒ“ã‚¹ä»˜é«˜é½¢è€…ä½å®…',
          'å°±åŠ´ç§»è¡Œæ”¯æ´','å°±åŠ´ç¶™ç¶šæ”¯æ´Aå‹','å°±åŠ´ç¶™ç¶šæ”¯æ´Bå‹','å°±åŠ´å®šç€æ”¯æ´','ç”Ÿæ´»ä»‹è­·','è‡ªç«‹è¨“ç·´ï¼ˆç”Ÿæ´»è¨“ç·´ï¼‰','è‡ªç«‹è¨“ç·´ï¼ˆæ©Ÿèƒ½è¨“ç·´ï¼‰','å…±åŒç”Ÿæ´»æ´åŠ©ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ãƒ›ãƒ¼ãƒ ï¼‰','çŸ­æœŸå…¥æ‰€ï¼ˆã‚·ãƒ§ãƒ¼ãƒˆã‚¹ãƒ†ã‚¤ï¼‰','å±…å®…ä»‹è­·ï¼ˆéšœå®³ï¼‰','é‡åº¦è¨ªå•ä»‹è­·','åŒè¡Œæ´è­·','è¡Œå‹•æ´è­·','ç§»å‹•æ”¯æ´','æ–½è¨­å…¥æ‰€æ”¯æ´',
    'ç‰¹å®šç›¸è«‡æ”¯æ´ï¼ˆè¨ˆç”»ç›¸è«‡ï¼‰','éšœå®³å…ç›¸è«‡æ”¯æ´','å…ç«¥ç™ºé”æ”¯æ´','æ”¾èª²å¾Œç­‰ãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹','ä¿è‚²æ‰€ç­‰è¨ªå•æ”¯æ´','å…ç«¥ç™ºé”æ”¯æ´ã‚»ãƒ³ã‚¿ãƒ¼','ã‚±ã‚¢ãƒãƒ','åŒ»ç™‚æ©Ÿé–¢','è¡Œæ”¿æ©Ÿé–¢','å¸‚å½¹æ‰€','ãã®ä»–'
        ];
        vals.forEach(v=>{ html += make(v,v); });
        html += '</div>';
        // ãã®ä»–è©³ç´°å…¥åŠ›
        const otherDetail = Array.from(selected).find(s=>s.startsWith('ãã®ä»–:'));
        const otherVal = otherDetail ? otherDetail.substring(3) : '';
        html += '<div id="e-type-other-wrap-'+id+'" style="margin-top:8px;'+(selected.has('ãã®ä»–')||otherDetail?'':'display:none;')+'">'
              + '<label>ãã®ä»–è©³ç´° <input type="text" id="e-type-other-'+id+'" placeholder="ç¨®é¡ã‚’å…¥åŠ›" value="'+(otherVal||'').replace(/\"/g,'&quot;')+'"></label>'
              + '</div>';
        return html;
      }
      function loadMunicipalityOptionsForRow(id, pref, current){
        const sel = document.getElementById('e-mun-'+id);
        sel.innerHTML = '<option value="">èª­ã¿è¾¼ã¿ä¸­...</option>';
        if (!pref) { sel.innerHTML = '<option value="">-- å…ˆã«éƒ½é“åºœçœŒ --</option>'; return; }
        google.script.run.withSuccessHandler(function(list){
          let html='<option value="">-- é¸æŠ --</option>';
          list.forEach(function(m){
            const val=m.municipality; html += '<option'+(val===current?' selected':'')+'>'+val+'</option>';
          });
          sel.innerHTML = html;
        }).getMunicipalities({ prefecture: pref });
      }
      function editFacility(id){
        const tr = document.getElementById('frow-'+id);
        if (!tr) return;
        const tds = tr.querySelectorAll('td');
        const name = tds[0].textContent; const pref = tds[1].textContent; const mun = tds[2].textContent; const type = tds[3].textContent; const addr = tds[4].textContent; const phone = tds[5].textContent;
        tds[0].innerHTML = '<input id="e-name-'+id+'" value="'+name.replace(/"/g,'&quot;')+'">';
        tds[1].innerHTML = '<select id="e-pref-'+id+'">'+prefOptionsHtml(pref)+'</select>';
        tds[2].innerHTML = '<select id="e-mun-'+id+'"><option value="">-- å…ˆã«éƒ½é“åºœçœŒ --</option></select>';
        tds[3].innerHTML = facilityTypeCheckboxesHtml(type, id);
        tds[4].innerHTML = '<input id="e-addr-'+id+'" value="'+addr.replace(/"/g,'&quot;')+'">';
        tds[5].innerHTML = '<input id="e-phone-'+id+'" value="'+phone.replace(/"/g,'&quot;')+'">';
        tds[6].innerHTML = '<button onclick="saveFacility(\''+id+'\')">ä¿å­˜</button> <button onclick="loadFacilitiesForManage()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>';
        // çœŒé¸æŠã‚¤ãƒ™ãƒ³ãƒˆã§å¸‚åŒºç”ºæ‘ã‚’ãƒ­ãƒ¼ãƒ‰
        document.getElementById('e-pref-'+id).addEventListener('change', function(){
          loadMunicipalityOptionsForRow(id, this.value, '');
        });
        // åˆæœŸã®å¸‚åŒºç”ºæ‘ä¸€è¦§èª­ã¿è¾¼ã¿
        if (pref) loadMunicipalityOptionsForRow(id, pref, mun);
        // ãã®ä»–ãƒã‚§ãƒƒã‚¯ã®è¡¨ç¤ºåˆ¶å¾¡
        tr.querySelectorAll('input[name="e-type-'+id+'"]').forEach(function(cb){
          cb.addEventListener('change', function(){
            if (this.value==='ãã®ä»–') {
              const wrap = document.getElementById('e-type-other-wrap-'+id);
              wrap.style.display = this.checked ? 'block':'none';
              if (!this.checked) document.getElementById('e-type-other-'+id).value='';
            }
          });
        });
      }
      function saveFacility(id){
        const data = {
          id: id,
          name: document.getElementById('e-name-'+id).value,
          prefecture: document.getElementById('e-pref-'+id).value,
          municipality: document.getElementById('e-mun-'+id).value,
          facilityType: (function(){
            const cbs = Array.from(document.querySelectorAll('input[name="e-type-'+id+'"]:checked'));
            let vals = cbs.map(cb=>cb.value);
            const otherIdx = vals.indexOf('ãã®ä»–');
            if (otherIdx !== -1) {
              const ov = (document.getElementById('e-type-other-'+id).value||'').trim();
              if (ov) { vals[otherIdx] = 'ãã®ä»–:'+ov; } else { vals.splice(otherIdx,1); }
            }
            return vals.join('ï¼');
          })(),
          address: document.getElementById('e-addr-'+id).value,
          phone: document.getElementById('e-phone-'+id).value,
        };
        if (!data.name) { alert('æ–½è¨­åã¯å¿…é ˆã§ã™'); return; }
        if (!data.facilityType) { alert('äº‹æ¥­æ‰€ç¨®é¡ã‚’1ã¤ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„'); return; }
        google.script.run.withSuccessHandler(function(){
          loadFacilitiesForManage();
        }).updateFacility(data);
      }

      // æ‹…å½“è€…ãƒ‘ãƒãƒ«
      function openContactsPanel(facilityId, encodedName){
        document.getElementById('contactsPanel').style.display = 'block';
        document.getElementById('contactsFacilityId').value = facilityId;
        document.getElementById('contactsFacilityName').textContent = decodeURIComponent(encodedName);
        loadContacts(facilityId);
      }
      function loadContacts(facilityId){
        const tbody = document.getElementById('contactsRows');
        tbody.innerHTML = '<tr><td colspan="6">èª­ã¿è¾¼ã¿ä¸­...</td></tr>';
        google.script.run.withSuccessHandler(function(list){
          window._contactsCacheManage = list || [];
          renderContacts();
        }).getFacilityContacts({ facilityId: facilityId });
      }
      function renderContacts(){
        const tbody = document.getElementById('contactsRows');
        const kw = (document.getElementById('contactsFilter').value || '').toLowerCase();
        const list = (window._contactsCacheManage || []).filter(function(c){
          if (!kw) return true;
          const hay = ((c.contactName||'')+' '+(c.contactNotes||'')).toLowerCase();
          return hay.includes(kw);
        });
        if (!list.length) { tbody.innerHTML = '<tr><td colspan="6">æ‹…å½“è€…ãŒã„ã¾ã›ã‚“</td></tr>'; return; }
        let html = '';
        list.forEach(function(c){
          html += '<tr id="crow-'+c.id+'">'
           + '<td class="c-name">'+escapeHtml(c.contactName||'')+'</td>'
           + '<td class="c-phone">'+escapeHtml(c.contactPhone||'')+'</td>'
           + '<td class="c-notes">'+escapeHtml(c.contactNotes||'')+'</td>'
           + '<td>'+(c.cardFileId ? ('<img src="https://drive.google.com/uc?export=view&id='+escapeHtml(c.cardFileId)+'" style="max-width:80px;max-height:60px;object-fit:cover;border:1px solid #ccc;">') : 'â€”')+'</td>'
           + '<td>'+escapeHtml(c.createdAt||'')+'</td>'
           + '<td>'
           +   '<button onclick="editContactM(\''+c.id+'\')">ç·¨é›†</button> '
           +   '<button onclick="triggerCardUploadM(\''+c.id+'\')">ååˆº</button> '
           +   '<button onclick="deleteContactM(\''+c.id+'\')">å‰Šé™¤</button>'
           + '</td>'
           + '</tr>';
        });
        tbody.innerHTML = html;
      }
      function addContactM(){
        const fid = document.getElementById('contactsFacilityId').value;
        const name = document.getElementById('m-contactName').value.trim();
        const phone = document.getElementById('m-contactPhone').value.trim();
        const notes = document.getElementById('m-contactNotes').value.trim();
        if (!fid) { alert('æ–½è¨­ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“'); return; }
        if (!name) { alert('æ‹…å½“è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
        google.script.run.withSuccessHandler(function(){
          document.getElementById('m-contactName').value = '';
          document.getElementById('m-contactPhone').value = '';
          document.getElementById('m-contactNotes').value = '';
          loadContacts(fid);
        }).addFacilityContact({ facilityId: fid, contactName: name, contactPhone: phone, contactNotes: notes });
      }
      function editContactM(id){
        const tr = document.getElementById('crow-'+id);
        if (!tr) return;
        const name = tr.querySelector('.c-name').textContent;
        const phone = tr.querySelector('.c-phone').textContent;
        const notes = tr.querySelector('.c-notes').textContent;
        tr.querySelector('.c-name').innerHTML = '<input id="ce-name-'+id+'" value="'+name.replace(/"/g,'&quot;')+'">';
        tr.querySelector('.c-phone').innerHTML = '<input id="ce-phone-'+id+'" value="'+phone.replace(/"/g,'&quot;')+'">';
        tr.querySelector('.c-notes').innerHTML = '<textarea id="ce-notes-'+id+'" rows="2">'+notes.replace(/</g,'&lt;').replace(/>/g,'&gt;')+'</textarea>';
        tr.querySelector('td:last-child').innerHTML = '<button onclick="saveContactM(\''+id+'\')">ä¿å­˜</button> <button onclick="loadContacts(document.getElementById(\'contactsFacilityId\').value)">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>';
      }
      function saveContactM(id){
        const name = document.getElementById('ce-name-'+id).value.trim();
        const phone = document.getElementById('ce-phone-'+id).value.trim();
        const notes = document.getElementById('ce-notes-'+id).value.trim();
        if (!name) { alert('æ‹…å½“è€…åã¯å¿…é ˆã§ã™'); return; }
        google.script.run.withSuccessHandler(function(){
          const fid = document.getElementById('contactsFacilityId').value;
          loadContacts(fid);
        }).updateFacilityContact({ id: id, contactName: name, contactPhone: phone, contactNotes: notes });
      }
      function deleteContactM(id){
        if (!confirm('æ‹…å½“è€…ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
        google.script.run.withSuccessHandler(function(){
          const fid = document.getElementById('contactsFacilityId').value;
          loadContacts(fid);
        }).deleteFacilityContact(id);
      }
      function triggerCardUploadM(id){
        const input = document.getElementById('m-cardUpload');
        input.dataset.contactId = id;
        input.click();
      }
      function handleCardFileChangeM(ev){
        const input = ev.target;
        const contactId = input.dataset.contactId;
        if (!contactId || !input.files || !input.files.length) return;
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          const dataUrl = e.target.result;
          google.script.run.withSuccessHandler(function(){
            const fid = document.getElementById('contactsFacilityId').value;
            loadContacts(fid);
          }).uploadFacilityContactCard({ contactId: contactId, dataUrl: dataUrl, filename: file.name });
        };
        reader.readAsDataURL(file);
        input.value = '';
      }

      window.addEventListener('load', function(){ initTheme(); loadFacilitiesForManage(); });
    </script>
  </head>
  <body>
    <nav>
      <a href="<?= ScriptApp.getService().getUrl(); ?>?page=index">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</a>
      <a href="<?= ScriptApp.getService().getUrl(); ?>?page=facilities">æ–½è¨­ç™»éŒ²</a>
      <a href="<?= ScriptApp.getService().getUrl(); ?>?page=visits">å•ã„åˆã‚ã›è¨˜éŒ²</a>
      <a href="<?= ScriptApp.getService().getUrl(); ?>?page=reports">å–¶æ¥­å ±å‘Š</a>
      <a href="<?= ScriptApp.getService().getUrl(); ?>?page=employees">ç¤¾å“¡</a>
  <button id="themeToggleBtn" type="button" onclick="toggleTheme()" aria-label="ãƒ†ãƒ¼ãƒåˆ‡æ›¿">ğŸŒ“</button>
    </nav>

    <h1>æ–½è¨­ãƒ»æ‹…å½“è€… ç®¡ç†</h1>
    <div class="grid">
      <section>
        <h2>æ–½è¨­ä¸€è¦§</h2>
        <div class="flex" style="margin-bottom:8px;">
          <input id="facFilterKw" type="text" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆæ–½è¨­åãƒ»ä½æ‰€ãƒ»å¸‚åŒºç”ºæ‘ãƒ»å‚™è€ƒï¼‰" oninput="renderFacilityRows()" style="flex:1;">
          <select id="facFilterPref" onchange="renderFacilityRows()">
            <option value="">éƒ½é“åºœçœŒ</option>
            <option>æ±äº¬éƒ½</option><option>ç¥å¥ˆå·çœŒ</option><option>åƒè‘‰çœŒ</option><option>åŸ¼ç‰çœŒ</option><option>èŒ¨åŸçœŒ</option><option selected>æ ƒæœ¨çœŒ</option><option>ç¾¤é¦¬çœŒ</option><option>å±±æ¢¨çœŒ</option>
          </select>
          <input id="facFilterType" placeholder="ç¨®é¡ã§çµã‚Šè¾¼ã¿ï¼ˆå®Œå…¨ä¸€è‡´ï¼‰" oninput="renderFacilityRows()" />
        </div>
        <div class="table-wrap">
        <table>
          <thead><tr><th>æ–½è¨­å</th><th>éƒ½é“åºœçœŒ</th><th>å¸‚åŒºç”ºæ‘</th><th>ç¨®é¡</th><th>ä½æ‰€</th><th>é›»è©±</th><th></th></tr></thead>
          <tbody id="facManageRows"><tr><td colspan="8">èª­ã¿è¾¼ã¿ä¸­...</td></tr></tbody>
        </table>
        </div>
      </section>
      <section>
        <h2>æ‹…å½“è€…</h2>
        <div id="contactsPanel" style="display:none;">
          <div class="muted">æ–½è¨­: <span id="contactsFacilityName"></span></div>
          <input type="hidden" id="contactsFacilityId" />
          <div style="margin-top:8px;">
            <input id="m-contactName" placeholder="æ‹…å½“è€…å"> 
            <input id="m-contactPhone" placeholder="é›»è©±">
            <input id="m-contactNotes" placeholder="å‚™è€ƒ">
            <button onclick="addContactM()">è¿½åŠ </button>
          </div>
          <div style="margin-top:8px;">
            <input id="contactsFilter" type="text" placeholder="æ‹…å½“è€…ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆæ°åãƒ»å‚™è€ƒï¼‰" oninput="renderContacts()">
          </div>
          <div class="table-wrap">
          <table>
            <thead><tr><th>æ°å</th><th>é›»è©±</th><th>å‚™è€ƒ</th><th>ååˆº</th><th>ç™»éŒ²æ—¥æ™‚</th><th></th></tr></thead>
            <tbody id="contactsRows"><tr><td colspan="6">æ–½è¨­ã‚’é¸æŠã—ã¦ãã ã•ã„</td></tr></tbody>
          </table>
          </div>
        </div>
        <div id="contactsPlaceholder" class="muted" style="margin-top:8px;">å·¦ã®ä¸€è¦§ã‹ã‚‰ã€Œæ‹…å½“è€…ã€ãƒœã‚¿ãƒ³ã§æ–½è¨­ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</div>
      </section>
    </div>

    <!-- ååˆºã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ hidden input -->
    <input id="m-cardUpload" type="file" accept="image/*" style="display:none" onchange="handleCardFileChangeM(event)">
  </body>
</html>
